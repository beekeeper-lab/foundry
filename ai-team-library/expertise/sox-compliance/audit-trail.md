# Audit Trail

Standards for implementing and maintaining audit trails that support SOX
compliance. Audit trails provide the evidentiary basis for demonstrating
that controls are designed and operating effectively.

---

## Defaults

- **Retention:** Minimum 7 years for financial records (SEC Rule 17a-4
  analogy; consult legal counsel for specific requirements).
- **Immutability:** Audit logs must be tamper-evident. Write-once storage
  or cryptographic chaining recommended.
- **Completeness:** Every financially significant transaction must be
  traceable from initiation to financial statement impact.
- **Timeliness:** Logs must be generated in real time or near-real time.
  Batch logging is insufficient for detective controls.

---

## What to Log

| Category | Events | Required Fields |
|----------|--------|-----------------|
| **Financial transactions** | Create, modify, delete, approve, post | Who, what, when, before/after values, approval chain |
| **Access events** | Login, logout, failed login, privilege escalation | User, timestamp, source IP, success/failure |
| **Data changes** | Insert, update, delete on financial tables | User, table, field, old value, new value, timestamp |
| **System changes** | Configuration changes, deployments, patches | Who approved, who deployed, what changed, when |
| **Access management** | User provisioning, deprovisioning, role changes | Requestor, approver, user affected, access granted/revoked |

---

## Audit Trail Architecture

```
  Transaction / Event
        │
        ▼
  ┌──────────────┐
  │  Application  │  Application-level audit log
  │  Audit Log    │  (business context: who approved what)
  └──────┬───────┘
         │
         ▼
  ┌──────────────┐
  │  Database     │  Database-level audit log
  │  Audit Log    │  (data changes: before/after values)
  └──────┬───────┘
         │
         ▼
  ┌──────────────┐
  │  System       │  OS and infrastructure logs
  │  Audit Log    │  (access, authentication, system events)
  └──────┬───────┘
         │
         ▼
  ┌──────────────┐
  │  Centralized  │  SIEM or log aggregation platform
  │  Log Store    │  (correlation, alerting, retention)
  └──────────────┘
```

All layers feed into a centralized, immutable log store. Gaps between
layers indicate missing controls.

---

## Evidence Standards

For audit evidence to support SOX compliance, it must meet these criteria:

| Criterion | Description |
|-----------|-------------|
| **Sufficient** | Enough evidence to support the conclusion |
| **Appropriate** | Relevant to the control being tested |
| **Reliable** | Generated by the system, not manually created after the fact |
| **Timely** | Recorded at or near the time of the event |
| **Complete** | Covers the full population, not just a sample (for automated controls) |

---

## Do / Don't

- **Do** implement audit logging at both the application and database layers.
  Application logs capture business context; database logs capture data
  integrity.
- **Do** use centralized, tamper-evident log storage. Logs stored on the
  same system they monitor can be altered.
- **Do** define log retention policies aligned with legal and regulatory
  requirements. SOX does not specify exact retention, but 7 years is a
  common baseline.
- **Do** regularly test that audit logs are complete and accurate by
  performing sample transaction walkthroughs.
- **Do** include audit trail requirements in vendor and system selection
  criteria.
- **Don't** log sensitive data (passwords, full credit card numbers) in
  audit trails. Log the event, not the secret.
- **Don't** allow application users or administrators to modify or delete
  audit logs. Logs must be append-only.
- **Don't** assume logging is enabled by default. Many systems require
  explicit configuration to capture the events needed for SOX.
- **Don't** treat audit trail as a post-implementation add-on. Design it
  into systems from the start.

---

## Common Pitfalls

1. **Logging gaps.** Critical tables or processes are not covered by audit
   logging. Solution: map every financially significant process to its
   audit trail and verify coverage.
2. **Log tampering.** Administrators can modify or delete logs on systems
   they manage. Solution: ship logs to a separate, restricted system in
   real time.
3. **Missing context.** Database logs show a row changed but not why or by
   whom (e.g., changes made through a service account). Solution: implement
   application-level logging that ties changes to individual users and
   business transactions.
4. **Retention failure.** Logs are rotated or purged before the retention
   period expires. Solution: automate retention enforcement with alerts
   for approaching capacity limits.
5. **Unreviewed logs.** Logs exist but nobody monitors them. Detective
   controls require active review. Solution: define review procedures with
   assigned owners and documented evidence of review.

---

## Checklist

- [ ] Audit logging enabled for all financially significant applications
- [ ] Database-level change tracking enabled for financial tables
- [ ] Access and authentication events are logged
- [ ] System and configuration changes are logged
- [ ] Logs are shipped to centralized, tamper-evident storage
- [ ] Log retention policy defined and enforced (minimum 7 years)
- [ ] Log review procedures defined with assigned owners
- [ ] Sample transaction walkthroughs verify audit trail completeness
- [ ] Audit trail requirements included in system selection criteria
