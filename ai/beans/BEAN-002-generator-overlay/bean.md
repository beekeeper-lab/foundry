# BEAN-002: Generator Overlay Mode

| Field | Value |
|-------|-------|
| **Bean ID** | BEAN-002 |
| **Status** | New |
| **Priority** | High |
| **Created** | 2026-02-07 |
| **Owner** | (unassigned) |

## Problem Statement

The generator currently only outputs to a new directory. When dogfooding Foundry for its own development, we had to generate to a staging directory and manually copy `.claude/` and `ai/` into the project root. This is fragile and doesn't support re-generation (e.g., after adding a persona or changing stacks).

## Goal

Add an overlay mode to the generator that can write `.claude/` and `ai/` directly into an existing project directory, merging with existing content rather than requiring a clean output directory.

## Scope

### In Scope
- New `--overlay` flag for `foundry-cli generate`
- Overlay logic: write generated files into existing project, skip/warn on conflicts
- Conflict detection: report files that differ between generated and existing
- Dry-run mode: show what would change without writing

### Out of Scope
- Automatic merge of conflicting files (user resolves manually)
- GUI support for overlay mode (follow-up bean)

## Acceptance Criteria

- [ ] `foundry-cli generate --overlay <dir>` writes into an existing directory
- [ ] Existing files not generated by Foundry are left untouched
- [ ] Conflicts are reported clearly (file path + reason)
- [ ] `--dry-run` flag shows planned changes without writing
- [ ] Tests cover overlay, conflict detection, and dry-run scenarios
- [ ] All tests pass (`uv run pytest`)
- [ ] Lint clean (`uv run ruff check foundry_app/`)

## Tasks

| # | Task | Owner | Depends On | Status |
|---|------|-------|------------|--------|
| | | | | |

> Tasks are populated by the Team Lead during decomposition.
> Task files go in `tasks/` subdirectory.

## Notes

This is the highest-priority bean because it directly unblocks iterative use of Foundry on existing projects â€” the core dogfooding use case.
